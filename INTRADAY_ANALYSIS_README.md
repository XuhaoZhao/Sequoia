# 股票分时数据分析功能说明

## 功能概述

`Stock.analyze_intraday_tick_data()` 方法提供了全面的股票日内分时数据分析功能，可以从成交明细数据中提取出多维度的市场信息。

## 数据格式要求

输入数据应为 pandas DataFrame，包含以下列：

| 列名 | 说明 | 示例 |
|------|------|------|
| 时间 | 成交时间 | 09:15:00 |
| 成交价 | 成交价格 | 10.60 |
| 手数 | 成交手数 | 1547 |
| 买卖盘性质 | 买盘/卖盘/中性盘 | 买盘 |

## 使用方法

```python
from financial_framework.stock import Stock
import pandas as pd

# 准备数据
df = pd.DataFrame({
    '时间': ['09:15:00', '09:15:09', ...],
    '成交价': [10.60, 10.57, ...],
    '手数': [11, 1547, ...],
    '买卖盘性质': ['中性盘', '买盘', ...]
})

# 创建Stock实例
stock = Stock()

# 执行分析（可选：设置大单阈值，默认500手）
result = stock.analyze_intraday_tick_data(df, big_order_threshold=100)
```

## 分析功能详解

### 1. 资金流向分析 (capital_flow)

**功能说明**：统计主动买入和卖出的资金量，判断主力资金动向

**输出指标**：
- **买盘金额**: 主动买入的总金额
- **卖盘金额**: 主动卖出的总金额
- **中性盘金额**: 中性盘成交金额
- **总成交额**: 总成交金额
- **净流入**: 买盘金额 - 卖盘金额（正值表示流入，负值表示流出）
- **买盘占比**: 买盘金额占总成交额的百分比
- **卖盘占比**: 卖盘金额占总成交额的百分比
- **中性盘占比**: 中性盘金额占总成交额的百分比
- **买卖比**: 买盘金额/卖盘金额
- **主力动向**: 主动买入/主动卖出/平衡

**应用场景**：
- 判断当日主力资金是流入还是流出
- 评估多空力量对比
- 识别资金异动

### 2. 关键时段分析 (key_periods)

**功能说明**：将交易时段划分为6个关键时段，分别分析各时段特征

**时段划分**：
1. **开盘竞价** (09:15-09:30)
2. **早盘** (09:30-10:30)
3. **午盘前** (10:30-11:30)
4. **午盘后** (13:00-14:00)
5. **下午盘** (14:00-14:30)
6. **尾盘** (14:30-15:00)

**每个时段输出指标**：
- **成交笔数**: 该时段成交次数
- **成交额**: 该时段总成交金额
- **平均价格**: 该时段平均成交价
- **价格变化**: 时段收盘价 - 时段开盘价
- **净流入**: 该时段资金净流入
- **资金流向**: 流入/流出

**应用场景**：
- 识别主力在哪个时段活跃
- 发现尾盘拉升或打压行为
- 分析开盘竞价的资金态度

### 3. 大单追踪 (big_orders)

**功能说明**：识别和追踪超过设定阈值的大额交易

**输出指标**：
- **大单总数**: 超过阈值的交易笔数
- **大单阈值(手)**: 设定的大单标准
- **大买单数量**: 大额买单数量
- **大卖单数量**: 大额卖单数量
- **大买单金额**: 大额买单总金额
- **大卖单金额**: 大额卖单总金额
- **最大单笔成交(手)**: 最大一笔交易的手数
- **最大单笔金额**: 最大一笔交易的金额
- **大单明细(前10笔)**: 前10笔大单的详细信息
  - 时间
  - 价格
  - 手数
  - 金额
  - 方向
- **大单资金流向**: 流入/流出/平衡

**应用场景**：
- 追踪机构或大户的操作
- 识别异常大单
- 判断主力建仓或出货意图

### 4. 价格波动分析 (price_volatility)

**功能说明**：分析价格波动特征和趋势

**输出指标**：
- **开盘价**: 第一笔成交价
- **收盘价**: 最后一笔成交价
- **最高价**: 全天最高价
- **最低价**: 全天最低价
- **振幅**: 最高价 - 最低价
- **振幅百分比(%)**: 振幅/开盘价 * 100
- **涨跌额**: 收盘价 - 开盘价
- **涨跌幅(%)**: 涨跌额/开盘价 * 100
- **价格波动率**: 价格标准差
- **价格趋势**: 上涨/下跌/震荡（基于线性回归）
- **趋势斜率**: 线性回归斜率值
- **高频价格区间**: 成交最活跃的价格区间（前5个）

**应用场景**：
- 评估股票活跃度
- 识别支撑位和压力位
- 判断价格趋势方向

### 5. 买卖盘力量对比 (trading_power)

**功能说明**：分析买卖双方的力量对比和持续性

**输出指标**：
- **买盘笔数**: 主动买入笔数
- **卖盘笔数**: 主动卖出笔数
- **中性盘笔数**: 中性盘笔数
- **买卖笔数比**: 买盘笔数/卖盘笔数
- **最长连续买盘笔数**: 最长连续主动买入次数
- **最长连续卖盘笔数**: 最长连续主动卖出次数
- **最大连续买盘金额**: 最大连续买入的累计金额
- **最大连续卖盘金额**: 最大连续卖出的累计金额
- **平均成交频率(笔/分钟)**: 每分钟平均成交次数
- **盘口强弱**: 买方强势/卖方强势/多空平衡

**应用场景**：
- 判断多空力量对比
- 识别持续性买入或卖出压力
- 评估市场活跃度

### 6. 交易策略信号识别 (strategy_signals)

**功能说明**：自动识别常见的交易信号和异常模式

**识别的信号类型**：

#### 6.1 拉升信号
- **触发条件**: 短时间内价格涨幅超过0.5%
- **输出信息**: 时间、价格、涨幅、成交量

#### 6.2 砸盘信号
- **触发条件**: 短时间内价格跌幅超过0.5%
- **输出信息**: 时间、价格、跌幅、成交量

#### 6.3 洗盘信号
- **触发条件**: 价格在某区间窄幅震荡，波动率小于0.5%
- **输出信息**: 震荡中枢、震荡幅度

#### 6.4 疑似对倒
- **触发条件**: 买卖盘方向切换率超过50%
- **输出信息**: 切换率、风险提示

#### 6.5 尾盘拉升/砸盘
- **触发条件**: 14:30-15:00时段价格波动超过1%
- **输出信息**: 价格变化、变化幅度、成交量

**应用场景**：
- 自动识别交易机会
- 发现异常交易行为
- 风险预警

### 7. 综合摘要 (summary)

**功能说明**：汇总所有分析结果，生成综合评估

**输出指标**：
- **数据记录数**: 分析的数据条数
- **时间跨度(分钟)**: 数据覆盖的时间长度
- **分析时间**: 执行分析的时间戳
- **综合结论**: 多条关键结论的列表
- **市场状态**: 综合判断的市场状态
  - 强势上涨
  - 弱势下跌
  - 震荡整理
  - 资金流入但价格未涨，可能在吸筹
  - 资金流出但价格未跌，可能在出货
  - 市场分歧

**应用场景**：
- 快速了解整体情况
- 生成分析报告
- 辅助交易决策

## 返回值结构

```python
{
    'summary': {
        '数据记录数': 4401,
        '时间跨度(分钟)': 345.0,
        '分析时间': '2025-10-15 14:30:00',
        '综合结论': [
            '资金净流入12345.67元，买盘占比52%',
            '价格下跌，涨跌幅-0.94%',
            '盘口表现：多空平衡'
        ],
        '市场状态': '震荡整理'
    },
    'capital_flow': {
        '买盘金额': 1234567.89,
        '卖盘金额': 1222222.22,
        '净流入': 12345.67,
        ...
    },
    'key_periods': {
        '开盘竞价(09:15-09:30)': {
            '成交笔数': 5,
            '成交额': 12345.67,
            ...
        },
        ...
    },
    'big_orders': {
        '大单总数': 3,
        '大单明细(前10笔)': [
            {
                '时间': '15:00:00',
                '价格': 10.50,
                '手数': 8338,
                '金额': 875490.0,
                '方向': '买盘'
            },
            ...
        ],
        ...
    },
    'price_volatility': {
        '开盘价': 10.60,
        '收盘价': 10.50,
        '涨跌幅(%)': -0.94,
        '价格趋势': '下跌',
        ...
    },
    'trading_power': {
        '买盘笔数': 2200,
        '卖盘笔数': 2196,
        '盘口强弱': '多空平衡',
        ...
    },
    'strategy_signals': {
        '信号总数': 2,
        '信号明细': [
            {
                '信号类型': '砸盘',
                '时间': '09:15:09',
                '价格': 10.57,
                '跌幅': -0.03
            },
            ...
        ]
    }
}
```

## 运行示例

```bash
# 运行示例代码
python example_intraday_analysis.py
```

示例代码会：
1. 使用样本数据进行分析
2. 在终端打印格式化的分析结果
3. 将完整结果保存到 `intraday_analysis_result.json` 文件

## 实战应用建议

### 1. 日内交易策略
- 关注**尾盘信号**：尾盘拉升可能预示次日高开
- 监控**大单动向**：大买单密集出现可能是主力建仓
- 观察**时段资金流**：早盘流入+尾盘流出可能是日内短线

### 2. 风险控制
- **对倒预警**：高频切换可能存在操纵风险
- **巨额大单**：突然出现超大单要警惕对手盘
- **波动率监控**：异常高波动可能伴随高风险

### 3. 趋势判断
- **资金+价格双确认**：净流入且价格上涨 = 强势
- **背离识别**：资金流入但价格不涨 = 可能在吸筹
- **连续性观察**：连续买盘 > 连续卖盘 = 买方强势

## 注意事项

1. **数据质量**：确保输入数据完整且格式正确
2. **阈值设置**：根据股票特性调整大单阈值（流通盘大的股票可以设高一些）
3. **结合其他指标**：分时数据分析应结合K线、成交量等其他技术指标
4. **市场环境**：牛熊市中信号的可靠性会有差异
5. **不构成投资建议**：本工具仅供技术分析参考，不构成任何投资建议

## 技术支持

如有问题或建议，请查看源代码 `financial_framework/stock.py` 中的详细实现。
